{% extends 'base.html' %}

{% block quill %}
<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
{% endblock %}

{% block header %}
  <h1 class="text-3xl font-bold text-gray-800">{% block title %}New Post{% endblock %}</h1>
{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-md">
  <!-- Our form still posts to your Flask route -->
  <form method="post" class="space-y-6" id="post-form">

    <!-- Title -->
    <div>
      <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
      <input 
        type="text" 
        name="title" 
        id="title" 
        class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm 
               focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" 
        required 
      >
    </div>
    
    <!-- Quill Editor Container -->
    <div>
      <label for="editor" class="block text-sm font-medium text-gray-700">Body</label>
      <div 
        id="editor" 
        class="mt-1 block w-full h-52 border border-gray-300 rounded-lg" 
      ></div>
    </div>

    <!-- Hidden input to store Quill's HTML content on submit -->
    <input type="hidden" name="body" id="hiddenBody">

    <!-- Submit Button -->
    <div class="flex justify-center">
      <button 
        type="submit" 
        class="px-6 py-2 text-white bg-indigo-600 hover:bg-indigo-700 font-medium rounded-lg"
      >
        Save
      </button>
    </div>
  </form>
</div>

<!-- Quill JS Initialization -->
<script>
  // 1) Initialize Quill
  var quill = new Quill('#editor', {
    theme: 'snow',  // 'bubble' is another theme
    modules: {
      toolbar: [
        ['bold', 'italic', 'underline', 'strike'],        // text formatting
        [{ 'header': 1 }, { 'header': 2 }],               // headers
        [{ 'list': 'ordered'}, { 'list': 'bullet' }],     // lists
        ['link', 'code-block']                            // link and code
      ]
    }
  });

  // 2) Copy Quill content into hidden <input> before submitting
  document.getElementById('post-form').onsubmit = function() {
    // Get HTML content from Quill
    var htmlContent = quill.root.innerHTML;

    // Store it in hidden input
    document.getElementById('hiddenBody').value = htmlContent;
  };
</script>
{% endblock %}
